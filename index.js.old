// This file is now a redirect to the standard src/index.js entry point.
import './src/index.js';
      alert("Please enter a destination first!");
      return;
    }

    setLoading(true);

    // Serialize current state
    const existingItinerary = itinerary.map(i => 
        `- ${i.date} ${i.time}: ${i.title} [Type: ${i.type}] [Category: ${i.category}] [Cost: ${i.cost} ${i.currency}] @ ${i.location || 'No Loc'}`
    ).join('\n');

    const existingTasks = preTripTasks.map(t => 
        `- ${t.text} [Status: ${t.done ? 'Done' : 'Pending'}] [Cost: ${t.cost} ${t.currency}]`
    ).join('\n');

    const budgetStatus = `Budget: ${tripDetails.budget} ${tripDetails.homeCurrency}.`;

    const prompt = `
      I am planning a trip. Act as a travel agent.
      
      DETAILS:
      - Destination: "${tripDetails.destination}"
      - Origin: "${tripDetails.origin || 'Unknown'}"
      - Dates: ${tripDetails.startDate} to ${tripDetails.endDate}
      - Style: ${tripDetails.travelStyle}
      - Home Currency: ${tripDetails.homeCurrency}
      - USER INSTRUCTIONS: "${customPrompt}"
      
      CURRENT STATUS:
      ${budgetStatus}

      EXISTING ITINERARY (Context - Do not duplicate):
      ${existingItinerary || "None yet"}

      EXISTING TASKS (Context - Do not duplicate):
      ${existingTasks || "None yet"}

      GOAL:
      1. Detect the local currency for the destination (Trip Currency).
      2. Calculate exchange rate: 1 ${tripDetails.homeCurrency} = ? Trip Currency.
      3. Suggest new itinerary items filling gaps (include estimated cost in Trip Currency).
      4. Generate missing tasks (include estimated cost in Home or Trip Currency).
      5. Generate packing list.
      6. Phrasebook.

      RETURN JSON ONLY (No markdown):
      {
        "tripCurrency": "CODE",
        "exchangeRate": 1.0,
        "newPreTrip": [{"text": "Task", "cost": 0, "currency": "CODE", "category": "Category"}], 
        "newPacking": [ {"category": "Docs", "items": ["Item A"]} ],
        "newItinerary": [
          {
            "title": "Activity Name",
            "type": "Activity", 
            "category": "Activities",
            "date": "YYYY-MM-DD",
            "time": "HH:MM",
            "location": "Address",
            "notes": "Details",
            "isSuggestion": true,
            "estimatedCost": 0,
            "currency": "CODE"
          }
        ],
        "phrasebook": { "language": "Lang", "tips": "Tip", "phrases": [{"original":"x","phonetic":"y","english":"z"}] },
        "coordinates": {"lat": 0, "lng": 0}
      }
    `;

    console.log("--- AI PROMPT START ---");
    console.log(prompt);
    console.log("--- AI PROMPT END ---");

    try {
      let data;
      
      if (!apiKey) {
        // Mock Data
        await new Promise(r => setTimeout(r, 2000));
        data = {
          tripCurrency: "CZK",
          exchangeRate: 23.5, // Mock rate
          newPreTrip: [
            { text: "Check visa requirements", cost: 0, currency: "USD", category: "Documents" },
            { text: "Download Offline Maps", cost: 0, currency: "USD", category: "Other" }
          ],
          newPacking: [
            { category: "Documents", items: ["Passport", "Tickets"] },
            { category: "Tech", items: ["Charger", "Adapter"] }
          ],
          newItinerary: itinerary.length === 0 ? [
            { title: "Flight Arrival", type: "Flight", category: "Transport", date: tripDetails.startDate, time: "10:00", location: `${tripDetails.destination} Airport`, notes: "Pick up baggage", estimatedCost: 0, currency: "CZK" },
            { title: "Hotel Check-in", type: "Hotel", category: "Accommodation", date: tripDetails.startDate, time: "12:00", location: "Grand Hotel", notes: " confirmation #123", estimatedCost: 2000, currency: "CZK" },
            { title: "Local Dinner", type: "Food", category: "Food & Drink", date: tripDetails.startDate, time: "19:00", location: "City Center", notes: "Try local dish", estimatedCost: 500, currency: "CZK" }
          ] : [],
          phrasebook: {
            language: "Local Language",
            tips: "Be polite!",
            phrases: [{ original: "Hello", phonetic: "Hello", english: "Hello" }]
          },
          coordinates: { lat: 48.8566, lng: 2.3522 }
        };
      } else {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });
        if (!response.ok) throw new Error("API Request Failed");
        const result = await response.json();
        const text = result.candidates[0].content.parts[0].text.replace(/```json|```/g, '').trim();
        data = JSON.parse(text);
      }

      // Update exchange rate and trip currency if provided
      if (data.tripCurrency && data.exchangeRate) {
          setTripDetails(prev => ({
              ...prev, 
              tripCurrency: data.tripCurrency,
              exchangeRate: data.exchangeRate
          }));
      }

      const existingTaskTexts = new Set(preTripTasks.map(t => t.text.toLowerCase()));
      const uniqueNewTasks = (data.newPreTrip || [])
        .filter(t => !existingTaskTexts.has(t.text.toLowerCase()))
        .map(t => ({ 
            id: Date.now() + Math.random(), 
            text: t.text || t, // Handle if AI returns string or object
            done: false, 
            attachments: [], 
            cost: t.cost || 0, 
            currency: t.currency || tripDetails.homeCurrency, 
            isPaid: false, 
            category: t.category || 'Documents',
            isEditing: false 
        }));
      setPreTripTasks(prev => [...prev, ...uniqueNewTasks]);

      setPackingList(prev => {
        const newPkg = [...prev];
        data.newPacking.forEach(newCat => {
          const existingCat = newPkg.find(c => c.category === newCat.category);
          if (existingCat) {
             const existingItems = new Set(existingCat.items.map(i => i.text.toLowerCase()));
             const itemsToAdd = newCat.items
                .filter(i => !existingItems.has(i.toLowerCase()))
                .map(i => ({ id: Date.now() + Math.random(), text: i, done: false }));
             existingCat.items.push(...itemsToAdd);
          } else {
             newPkg.push({
               id: Date.now() + Math.random(),
               category: newCat.category,
               items: newCat.items.map(i => ({ id: Date.now() + Math.random(), text: i, done: false }))
             });
          }
        });
        return newPkg;
      });

      const formattedEvents = (data.newItinerary || []).map(e => ({
        ...e,
        id: Date.now() + Math.random(),
        image: null,
        cost: e.estimatedCost || 0,
        currency: e.currency || tripDetails.tripCurrency,
        isPaid: false,
        isEditing: false,
        category: e.category || 'Activities'
      }));
      setItinerary(prev => [...prev, ...formattedEvents].sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time)));

      if (data.phrasebook) setPhrasebook(data.phrasebook);
      if (data.coordinates && mapInstanceRef.current && window.L) {
        mapInstanceRef.current.setView([data.coordinates.lat, data.coordinates.lng], 12);
      }

      alert(`Trip plan updated! Currency set to ${data.tripCurrency || tripDetails.tripCurrency} (Rate: ${data.exchangeRate || tripDetails.exchangeRate})`);
      
    } catch (error) {
      console.error("AI Error:", error);
      alert(`Failed to update plan: ${error.message}`);
    } finally {
      setLoading(false);
    }
  };

  // --- Handlers ---

  const handleAddItem = (listType, categoryId = null) => {
    const text = prompt("Enter item name:");
    if (!text) return;

    if (listType === 'preTrip') {
      setPreTripTasks([...preTripTasks, { id: Date.now(), text, done: false, attachments: [], cost: 0, currency: tripDetails.homeCurrency, isPaid: false, category: 'Documents', isEditing: false }]);
    } else if (listType === 'packing' && categoryId) {
      setPackingList(packingList.map(cat => {
        if (cat.id === categoryId) {
          return { ...cat, items: [...cat.items, { id: Date.now(), text, done: false }] };
        }
        return cat;
      }));
    }
  };

  const handleAddAttachment = (taskId) => {
      const link = prompt("Enter a URL or a short note:");
      if (!link) return;

      setPreTripTasks(preTripTasks.map(task => {
          if (task.id === taskId) {
              return { 
                  ...task, 
                  attachments: [...(task.attachments || []), { id: Date.now(), link, type: link.startsWith('http') ? 'link' : 'note' }]
              };
          }
          return task;
      }));
  };

  const updateTask = (taskId, field, value) => {
      setPreTripTasks(preTripTasks.map(t => t.id === taskId ? { ...t, [field]: value } : t));
  };

  const handleAddExpense = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const amount = parseCost(formData.get('amount'));
    if (!amount) return;

    const newExpense = {
        id: Date.now(),
        title: formData.get('title'),
        category: formData.get('category'),
        amount: amount,
        currency: formData.get('currency'),
        date: new Date().toISOString()
    };
    setExpenses([...expenses, newExpense]);
    e.target.reset();
  };

  const toggleItem = (listType, itemId, categoryId = null) => {
    if (listType === 'preTrip') {
      setPreTripTasks(preTripTasks.map(t => t.id === itemId ? { ...t, done: !t.done } : t));
    } else if (listType === 'packing') {
      setPackingList(packingList.map(cat => {
        if (cat.id === categoryId) {
          return {
            ...cat,
            items: cat.items.map(i => i.id === itemId ? { ...i, done: !i.done } : i)
          };
        }
        return cat;
      }));
    }
  };

  const addItineraryItem = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const newItem = {
      id: Date.now(),
      title: formData.get('title'),
      type: formData.get('type'),
      category: formData.get('category'),
      time: formData.get('time'),
      date: formData.get('date'),
      location: formData.get('location'),
      notes: formData.get('notes'),
      image: formData.get('image') || null,
      cost: parseCost(formData.get('cost')),
      currency: formData.get('currency'),
      isPaid: formData.get('isPaid') === 'on',
      isEditing: false
    };
    setItinerary([...itinerary, newItem].sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time)));
    e.target.reset();
  };

  const updateItineraryItem = (id, field, value) => {
    setItinerary(itinerary.map(item => item.id === id ? { ...item, [field]: value } : item));
  };

  // --- Render Helpers ---

  const renderOverview = () => (
    <div className="space-y-6 animate-fadeIn">
      {/* Header Image & Main Inputs */}
      <div className="relative h-80 rounded-2xl overflow-hidden group shadow-lg">
        <img 
          src={tripDetails.coverImage} 
          alt="Cover" 
          className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent flex flex-col justify-end p-6 text-white">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
             <div>
                <label className="text-xs uppercase font-bold text-slate-300 tracking-wider">Destination</label>
                <input 
                  type="text"
                  value={tripDetails.destination}
                  onChange={(e) => setTripDetails(prev => ({...prev, destination: e.target.value}))}
                  placeholder="e.g. Kyoto, Japan"
                  className="bg-transparent border-b border-white/30 text-3xl font-bold placeholder-white/30 focus:outline-none focus:border-white w-full py-1"
                />
             </div>
             <div>
                <label className="text-xs uppercase font-bold text-slate-300 tracking-wider">Traveling From (Origin)</label>
                <input 
                  type="text"
                  value={tripDetails.origin}
                  onChange={(e) => setTripDetails(prev => ({...prev, origin: e.target.value}))}
                  placeholder="e.g. New York, USA"
                  className="bg-transparent border-b border-white/30 text-xl font-medium placeholder-white/30 focus:outline-none focus:border-white w-full py-2"
                />
             </div>
          </div>
          
          <div className="flex flex-wrap gap-6 text-white/90 items-end">
             <div className="flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-lg backdrop-blur-sm">
                <Calendar size={16} />
                <input 
                  type="date" 
                  className="bg-transparent focus:outline-none cursor-pointer text-sm font-mono"
                  value={tripDetails.startDate}
                  onChange={(e) => setTripDetails(prev => ({...prev, startDate: e.target.value}))}
                />
                <span>→</span>
                <input 
                  type="date" 
                  className="bg-transparent focus:outline-none cursor-pointer text-sm font-mono"
                  value={tripDetails.endDate}
                  onChange={(e) => setTripDetails(prev => ({...prev, endDate: e.target.value}))}
                />
             </div>
             <button 
                onClick={() => {
                  const url = prompt("Enter Image URL for cover:");
                  if(url) setTripDetails(prev => ({...prev, coverImage: url}));
                }}
                className="ml-auto text-xs bg-black/40 hover:bg-black/60 px-2 py-1 rounded flex items-center gap-1"
             >
                <Camera size={12} /> Change Cover
             </button>
          </div>
        </div>
      </div>

      {/* Control Center */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Settings & Plan Card */}
        <Card className="lg:col-span-2 p-6 bg-gradient-to-br from-indigo-600 to-violet-700 text-white border-none shadow-xl">
          <div className="flex items-start justify-between">
            <div className="flex-1 mr-4">
              <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <Sparkles className="text-yellow-300" /> Plan My Trip
              </h3>
              
              <div className="grid grid-cols-2 gap-4 mb-4">
                <div>
                   <label className="text-xs uppercase font-bold text-indigo-200">Trip Style</label>
                   <select 
                      value={tripDetails.travelStyle}
                      onChange={(e) => setTripDetails(prev => ({...prev, travelStyle: e.target.value}))}
                      className="w-full bg-white/10 border border-white/20 rounded-lg p-2 text-sm focus:outline-none focus:bg-white/20"
                   >
                      <option className="text-slate-800" value="Balanced">Balanced</option>
                      <option className="text-slate-800" value="Relaxed">Relaxed</option>
                      <option className="text-slate-800" value="Adventure">Adventure</option>
                      <option className="text-slate-800" value="Foodie">Foodie</option>
                      <option className="text-slate-800" value="Cultural">Cultural</option>
                   </select>
                </div>
                <div>
                   <label className="text-xs uppercase font-bold text-indigo-200">Total Budget ({tripDetails.homeCurrency})</label>
                   <input 
                      value={tripDetails.budget}
                      onChange={(e) => setTripDetails(prev => ({...prev, budget: e.target.value}))}
                      placeholder="e.g. 2000"
                      className="w-full bg-white/10 border border-white/20 rounded-lg p-2 text-sm focus:outline-none focus:bg-white/20" 
                   />
                </div>
              </div>

              <div className="mb-4">
                  <label className="text-xs uppercase font-bold text-indigo-200">Custom Instructions (Optional)</label>
                  <textarea 
                      value={customPrompt}
                      onChange={(e) => setCustomPrompt(e.target.value)}
                      placeholder="e.g. Focus on vegan food, avoid museums, include a day trip to..."
                      className="w-full bg-white/10 border border-white/20 rounded-lg p-2 text-sm focus:outline-none focus:bg-white/20 h-16"
                  />
              </div>

              {/* Currency Settings */}
              <div className="bg-white/10 p-3 rounded-lg mb-6 border border-white/10">
                  <div className="flex items-center gap-2 mb-2">
                      <RefreshCw size={14} className="text-indigo-200" /> 
                      <span className="text-xs font-bold text-indigo-200 uppercase">Currency Exchange (AI Auto-set)</span>
                  </div>
                  <div className="grid grid-cols-3 gap-2">
                      <div>
                          <label className="text-[10px] text-indigo-200 block">Home (Your Budget)</label>
                          <select 
                             value={tripDetails.homeCurrency}
                             onChange={(e) => setTripDetails(prev => ({...prev, homeCurrency: e.target.value}))}
                             className="w-full bg-black/20 rounded p-1 text-xs focus:outline-none focus:ring-1 focus:ring-white/50 border border-transparent"
                          >
                             {CURRENCIES.map(c => <option key={c.code} className="text-slate-800" value={c.code}>{c.code} ({c.symbol})</option>)}
                          </select>
                      </div>
                      <div>
                          <label className="text-[10px] text-indigo-200/70 block">Trip (Detected)</label>
                          <div className="w-full bg-black/10 rounded p-1 text-xs text-white/80 border border-white/5 cursor-not-allowed">
                             {tripDetails.tripCurrency}
                          </div>
                      </div>
                      <div>
                          <label className="text-[10px] text-indigo-200/70 block">Rate (1 {tripDetails.homeCurrency} = )</label>
                          <div className="w-full bg-black/10 rounded p-1 text-xs text-white/80 border border-white/5 cursor-not-allowed">
                             {tripDetails.exchangeRate}
                          </div>
                      </div>
                  </div>
              </div>

              <Button 
                onClick={generateTripInfo} 
                className="bg-white text-indigo-600 hover:bg-indigo-50 border-none w-full font-bold shadow-lg"
                disabled={loading}
              >
                {loading ? <Loader className="animate-spin" /> : "✨ Generate / Update Plan"}
              </Button>
            </div>
            <div className="hidden sm:block">
               <Globe className="text-indigo-400 opacity-40" size={120} />
            </div>
          </div>
        </Card>

        {/* Quick Actions & Stats */}
        <div className="space-y-4">
           {/* Budget Summary Mini-Card */}
           <Card className="p-4 border-slate-200">
               <div className="flex justify-between items-start mb-2">
                   <h4 className="font-bold text-slate-700 text-sm flex items-center gap-2">
                        <Wallet size={16} className="text-indigo-600"/> Budget
                   </h4>
                   <button onClick={() => setActiveTab('budget')} className="text-xs text-indigo-600 hover:underline">Manage</button>
               </div>
               <div className="space-y-2">
                   <div className="flex justify-between text-xs">
                        <span className="text-slate-500">Spent (Home)</span>
                        <span className="font-bold">{formatMoney(getBudgetTotals().totalSpent)}</span>
                   </div>
                   <div className="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                        <div 
                            className={`h-full rounded-full ${getBudgetTotals().remaining < 0 ? 'bg-red-500' : 'bg-emerald-500'}`} 
                            style={{ width: `${Math.min(100, (getBudgetTotals().totalSpent / (parseCost(tripDetails.budget) || 1)) * 100)}%` }}
                        ></div>
                   </div>
                   <div className="text-xs text-right text-slate-400">
                        Goal: {formatMoney(parseCost(tripDetails.budget))}
                   </div>
               </div>
           </Card>

           {/* Save/Load Card */}
           <Card className="p-4 bg-slate-50 border-slate-200">
              <h4 className="font-bold text-slate-700 mb-3 text-sm flex items-center gap-2">
                 <Save size={16} /> Trip Data
              </h4>
              <div className="flex gap-2">
                 <Button 
                   onClick={handleSaveTrip} 
                   variant="secondary" 
                   className="flex-1 text-xs h-9" 
                   icon={Download}
                 >
                   Save
                 </Button>
                 <Button 
                   component="label"
                   variant="secondary" 
                   className="flex-1 text-xs h-9" 
                   icon={Upload}
                 >
                   Load
                   <input type="file" accept=".json" onChange={handleLoadTrip} className="hidden" />
                 </Button>
              </div>
           </Card>

           {/* Lingo Mini-Card */}
           {phrasebook && (
              <Card className="p-4 bg-emerald-50 border-emerald-100">
                 <h4 className="font-bold text-emerald-800 mb-1 text-sm flex items-center gap-2">
                    <Languages size={14} /> {phrasebook.language}
                 </h4>
                 <p className="text-xs text-emerald-600 italic">"{phrasebook.tips}"</p>
              </Card>
           )}
        </div>
      </div>
    </div>
  );

  const renderChecklists = () => (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 animate-fadeIn">
      {/* Pre-Trip Section */}
      <div>
        <SectionTitle 
          icon={CheckSquare} 
          title="Pre-Trip Tasks" 
          subtitle="Visas, documents, and preparation." 
        />
        <div className="bg-white rounded-xl shadow-sm border border-slate-200">
          <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
            <span className="text-xs font-bold text-slate-400 tracking-wider">ACTION ITEMS</span>
            <button onClick={() => handleAddItem('preTrip')} className="text-indigo-600 hover:bg-indigo-50 p-1 rounded transition-colors">
              <Plus size={20} />
            </button>
          </div>
          <div className="divide-y divide-slate-100 max-h-[500px] overflow-y-auto">
            {preTripTasks.map(task => (
              <div key={task.id} className="p-4 hover:bg-slate-50 transition-colors group">
                {task.isEditing ? (
                    <div className="flex flex-col gap-2">
                        <input 
                            className="border p-1 rounded text-sm w-full"
                            value={task.text} 
                            onChange={(e) => updateTask(task.id, 'text', e.target.value)}
                        />
                        <div className="flex justify-end gap-2">
                            <button onClick={() => updateTask(task.id, 'isEditing', false)} className="text-xs bg-indigo-600 text-white px-2 py-1 rounded">Save</button>
                        </div>
                    </div>
                ) : (
                <div className="flex items-start gap-3">
                  <input 
                    type="checkbox" 
                    checked={task.done} 
                    onChange={() => toggleItem('preTrip', task.id)}
                    className="mt-1 w-5 h-5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer"
                  />
                  <div className="flex-1">
                      <span className={`text-sm text-slate-700 leading-relaxed block ${task.done ? 'line-through text-slate-400' : ''}`}>
                        {task.text}
                      </span>
                      
                      {/* Attachments & Cost */}
                      <div className="mt-2 flex flex-wrap gap-2 items-center">
                          {/* Cost Input */}
                          <div className={`flex items-center text-xs px-2 py-1 rounded border ${task.isPaid ? 'bg-emerald-50 border-emerald-200 text-emerald-700' : 'bg-white border-slate-200 text-slate-500'}`}>
                             <span className="mr-1">{CURRENCIES.find(c => c.code === task.currency)?.symbol}</span>
                             <input 
                                type="number" 
                                className="w-12 bg-transparent focus:outline-none"
                                value={task.cost || ''}
                                placeholder="0"
                                onChange={(e) => updateTask(task.id, 'cost', parseFloat(e.target.value))}
                             />
                             <select 
                                value={task.currency}
                                onChange={(e) => updateTask(task.id, 'currency', e.target.value)}
                                className="bg-transparent text-[10px] ml-1 focus:outline-none w-12"
                             >
                                {CURRENCIES.map(c => <option key={c.code} value={c.code}>{c.code}</option>)}
                             </select>
                             <select 
                                value={task.category || 'Documents'}
                                onChange={(e) => updateTask(task.id, 'category', e.target.value)}
                                className="bg-transparent text-[10px] ml-1 focus:outline-none border-l border-slate-200 pl-1 w-20"
                             >
                                {BUDGET_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                             </select>
                             <button 
                                onClick={() => updateTask(task.id, 'isPaid', !task.isPaid)}
                                className={`ml-2 p-0.5 rounded-full ${task.isPaid ? 'text-emerald-600' : 'text-slate-300 hover:text-slate-400'}`}
                                title={task.isPaid ? "Paid" : "Mark as Paid"}
                             >
                                <CheckCircle size={14} />
                             </button>
                          </div>

                          {task.attachments && task.attachments.map(att => (
                                  <div key={att.id} className="flex items-center gap-2 text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded w-max">
                                      {att.type === 'link' ? <LinkIcon size={12}/> : <FileText size={12} />}
                                      {att.type === 'link' ? (
                                          <a href={att.link} target="_blank" rel="noopener noreferrer" className="hover:underline truncate max-w-[150px]">
                                              {att.link}
                                          </a>
                                      ) : (
                                          <span>{att.link}</span>
                                      )}
                                  </div>
                          ))}
                      </div>
                  </div>
                  
                  <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                      <button onClick={() => updateTask(task.id, 'isEditing', true)} className="text-slate-300 hover:text-indigo-600 p-1">
                        <Edit2 size={16} />
                      </button>
                      <button onClick={() => handleAddAttachment(task.id)} className="text-slate-300 hover:text-indigo-600 p-1">
                        <Paperclip size={16} />
                      </button>
                      <button onClick={() => setPreTripTasks(preTripTasks.filter(t => t.id !== task.id))} className="text-slate-300 hover:text-red-500 p-1">
                        <Trash2 size={16} />
                      </button>
                  </div>
                </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Packing Section */}
      <div>
        <SectionTitle 
          icon={Briefcase} 
          title="Packing List" 
          subtitle="Essentials based on your trip style." 
        />
        <div className="space-y-4">
          {packingList.length === 0 && (
             <div className="p-8 text-center bg-white rounded-xl border border-dashed border-slate-300 text-slate-400 italic text-sm">
                Packing list empty.
             </div>
          )}
          {packingList.map(category => (
            <Card key={category.id} className="overflow-hidden">
              <div className="bg-slate-50 px-4 py-3 border-b border-slate-100 flex justify-between items-center group">
                <h4 className="font-semibold text-slate-700 text-sm">{category.category}</h4>
                <div className="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button onClick={() => handleAddItem('packing', category.id)} className="text-indigo-600 text-xs font-medium hover:underline">
                    + Item
                    </button>
                    <button onClick={() => setPackingList(prev => prev.filter(c => c.id !== category.id))} className="text-red-400 text-xs hover:text-red-600">
                    <Trash2 size={14} />
                    </button>
                </div>
              </div>
              <div className="divide-y divide-slate-100">
                {category.items.map(item => (
                  <div key={item.id} className="flex items-center gap-3 p-2 pl-4 hover:bg-slate-50 group">
                    <input 
                      type="checkbox" 
                      checked={item.done} 
                      onChange={() => toggleItem('packing', item.id, category.id)}
                      className="w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer"
                    />
                    <span className={`flex-1 text-sm text-slate-700 ${item.done ? 'line-through text-slate-400' : ''}`}>
                      {item.text}
                    </span>
                    <button 
                        onClick={() => setPackingList(prev => prev.map(c => c.id === category.id ? {...c, items: c.items.filter(i => i.id !== item.id)} : c))}
                        className="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 px-2"
                    >
                        <Trash2 size={14} />
                    </button>
                  </div>
                ))}
              </div>
            </Card>
          ))}
        </div>
      </div>
    </div>
  );

  const renderItinerary = () => {
    // Group items by date
    const groupedItinerary = itinerary.reduce((groups, item) => {
        const date = item.date;
        if (!groups[date]) groups[date] = [];
        groups[date].push(item);
        return groups;
    }, {});
    
    // Sort dates
    const sortedDates = Object.keys(groupedItinerary).sort();

    return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fadeIn">
      {/* Form Side */}
      <div className="lg:col-span-1">
        <SectionTitle icon={Calendar} title="Add Event" />
        <Card className="p-5 sticky top-6">
          <form onSubmit={addItineraryItem} className="space-y-4">
            <div>
              <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Title</label>
              <input name="title" required className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm" placeholder="e.g. Flight AA123" />
            </div>
            
            <div className="grid grid-cols-2 gap-3">
                <div>
                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Type</label>
                <select name="type" className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm">
                    <option value="Activity">Activity</option>
                    <option value="Flight">Flight</option>
                    <option value="Train">Train</option>
                    <option value="Hotel">Hotel</option>
                    <option value="Food">Food</option>
                </select>
                </div>
                <div>
                   <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Cost / Paid?</label>
                   <div className="flex gap-2">
                       <input type="number" name="cost" placeholder="0" className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm" />
                       <select name="currency" className="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm w-20">
                           {CURRENCIES.map(c => <option key={c.code} value={c.code}>{c.code}</option>)}
                       </select>
                   </div>
                   <div className="flex items-center mt-2 gap-2">
                      <input type="checkbox" name="isPaid" id="isPaidNew" className="w-4 h-4 text-indigo-600 rounded" />
                      <label htmlFor="isPaidNew" className="text-xs text-slate-600">Already Paid</label>
                   </div>
                </div>
            </div>
            
            <div>
                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Category (Budget)</label>
                <select name="category" className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm">
                    {BUDGET_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                </select>
            </div>

            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Date</label>
                <input type="date" name="date" required className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm" />
              </div>
              <div>
                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Time</label>
                <input type="time" name="time" required className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm" />
              </div>
            </div>
            <div>
              <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Location</label>
              <div className="relative">
                <MapPin className="absolute left-3 top-2.5 text-slate-400" size={16} />
                <input name="location" className="w-full pl-9 p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm" placeholder="Address or place name" />
              </div>
            </div>
            <Button type="submit" className="w-full">Add to Itinerary</Button>
          </form>
        </Card>
      </div>

      {/* Timeline Side */}
      <div className="lg:col-span-2">
        <SectionTitle icon={MapIcon} title="Your Timeline" />
        
        {itinerary.length === 0 ? (
           <div className="flex flex-col items-center justify-center py-20 text-slate-400 bg-white rounded-xl border border-dashed border-slate-300">
             <Calendar size={48} className="mb-4 opacity-50" />
             <p>No events planned yet.</p>
           </div>
        ) : (
          <div className="space-y-12">
            {sortedDates.map(dateKey => (
                <div key={dateKey} className="relative">
                    {/* Day Header */}
                    <div className="flex items-center justify-between mb-6 bg-slate-100 p-3 rounded-xl sticky top-20 z-20 shadow-sm">
                        <h3 className="font-bold text-slate-700 flex items-center gap-2">
                            <Calendar size={18} className="text-indigo-600"/>
                            {new Date(dateKey).toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' })}
                        </h3>
                        <a 
                            href={generateGoogleMapsLink(groupedItinerary[dateKey])} 
                            target="_blank" 
                            rel="noopener noreferrer"
                            className="text-xs bg-white text-blue-600 px-3 py-1.5 rounded-lg border border-blue-100 hover:bg-blue-50 flex items-center gap-1 font-medium transition-colors"
                        >
                            <MapIcon size={12} /> View Route
                        </a>
                    </div>
                    
                    {/* Events Line */}
                    <div className="space-y-8 relative before:absolute before:inset-0 before:ml-5 before:-translate-x-px before:h-full before:w-0.5 before:bg-gradient-to-b before:from-transparent before:via-slate-200 before:to-transparent">
                        {groupedItinerary[dateKey].map((item, idx) => (
                        <div key={item.id} className="relative flex items-start group">
                            {/* Timeline Dot */}
                            <div className={`absolute left-0 h-10 w-10 rounded-full flex items-center justify-center shadow-sm z-10 ${getEventColor(item.type)}`}>
                                {getEventIcon(item.type)}
                            </div>
                            
                            {/* Content */}
                            <div className="ml-16 bg-white rounded-xl p-5 shadow-sm border border-slate-100 flex-1 hover:shadow-md transition-shadow">
                            
                            {item.isEditing ? (
                                <div className="space-y-3">
                                    <input value={item.title} onChange={e => updateItineraryItem(item.id, 'title', e.target.value)} className="w-full border p-1 rounded text-sm font-bold" />
                                    <div className="grid grid-cols-2 gap-2">
                                        <input type="date" value={item.date} onChange={e => updateItineraryItem(item.id, 'date', e.target.value)} className="border p-1 rounded text-sm" />
                                        <input type="time" value={item.time} onChange={e => updateItineraryItem(item.id, 'time', e.target.value)} className="border p-1 rounded text-sm" />
                                    </div>
                                    <input value={item.location} onChange={e => updateItineraryItem(item.id, 'location', e.target.value)} className="w-full border p-1 rounded text-sm" placeholder="Location" />
                                    <textarea value={item.notes} onChange={e => updateItineraryItem(item.id, 'notes', e.target.value)} className="w-full border p-1 rounded text-sm h-20" placeholder="Notes" />
                                    <div className="flex gap-2">
                                        <select value={item.type} onChange={e => updateItineraryItem(item.id, 'type', e.target.value)} className="border p-1 rounded text-sm flex-1">
                                            <option value="Activity">Activity</option>
                                            <option value="Flight">Flight</option>
                                            <option value="Train">Train</option>
                                            <option value="Hotel">Hotel</option>
                                            <option value="Food">Food</option>
                                        </select>
                                        <select value={item.category} onChange={e => updateItineraryItem(item.id, 'category', e.target.value)} className="border p-1 rounded text-sm flex-1">
                                            {BUDGET_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                    </div>
                                    <div className="flex gap-2 items-center bg-slate-50 p-2 rounded">
                                        <label className="text-xs font-bold text-slate-500">Cost:</label>
                                        <input type="number" value={item.cost} onChange={e => updateItineraryItem(item.id, 'cost', parseFloat(e.target.value))} className="border p-1 rounded text-sm w-20" />
                                        <select value={item.currency} onChange={e => updateItineraryItem(item.id, 'currency', e.target.value)} className="border p-1 rounded text-sm w-20">
                                            {CURRENCIES.map(c => <option key={c.code} value={c.code}>{c.code}</option>)}
                                        </select>
                                        <div className="flex items-center gap-1 ml-2">
                                            <input type="checkbox" checked={item.isPaid} onChange={e => updateItineraryItem(item.id, 'isPaid', e.target.checked)} />
                                            <span className="text-xs">Paid</span>
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-2 mt-2">
                                        <Button variant="secondary" onClick={() => updateItineraryItem(item.id, 'isEditing', false)}>Cancel</Button>
                                        <Button onClick={() => updateItineraryItem(item.id, 'isEditing', false)} icon={SaveIcon}>Save</Button>
                                    </div>
                                </div>
                            ) : (
                                <div className="flex flex-col md:flex-row gap-4">
                                {item.image && (
                                <div className="w-full md:w-32 h-32 flex-shrink-0 rounded-lg overflow-hidden bg-slate-100 border border-slate-100">
                                    <img src={item.image} alt={item.title} className="w-full h-full object-cover" />
                                </div>
                                )}
                                <div className="flex-1">
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h4 className="font-bold text-lg text-slate-800">{item.title}</h4>
                                        <div className="flex items-center gap-2 text-xs font-bold text-slate-400 uppercase mt-1">
                                            <span>{item.type || 'Activity'}</span>
                                            {item.cost > 0 && (
                                                <span className={`px-2 py-0.5 rounded-full ${item.isPaid ? 'bg-emerald-100 text-emerald-600' : 'bg-amber-100 text-amber-600'}`}>
                                                    {item.currency} {item.cost} {item.isPaid ? '(Paid)' : '(Est)'}
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-sm font-bold text-indigo-600">{item.time}</div>
                                        <button onClick={() => updateItineraryItem(item.id, 'isEditing', true)} className="text-xs text-slate-400 hover:text-indigo-600 flex items-center justify-end gap-1 mt-1 w-full">
                                            <Edit2 size={12} /> Edit
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="flex items-center gap-1 text-sm text-slate-500 mt-2 mb-3">
                                    <MapPin size={14} />
                                    {item.location}
                                </div>
                                
                                {item.notes && (
                                    <p className="text-sm text-slate-600 bg-slate-50 p-3 rounded-lg italic border-l-2 border-slate-200">
                                    {item.notes}
                                    </p>
                                )}
                                
                                <div className="flex justify-between mt-4 items-end border-t border-slate-100 pt-3">
                                    <div className="flex items-center gap-2">
                                        <button 
                                            onClick={() => updateItineraryItem(item.id, 'isPaid', !item.isPaid)}
                                            className={`flex items-center gap-1 text-xs px-2 py-1 rounded border transition-colors ${item.isPaid ? 'bg-emerald-50 border-emerald-200 text-emerald-700' : 'bg-white border-slate-200 text-slate-500 hover:bg-slate-50'}`}
                                        >
                                            <CheckCircle size={12} /> {item.isPaid ? 'Paid' : 'Mark Paid'}
                                        </button>
                                        
                                    </div>
                                    <button 
                                        onClick={() => setItinerary(itinerary.filter(i => i.id !== item.id))}
                                        className="text-slate-300 hover:text-red-500 p-1"
                                    >
                                        <Trash2 size={16} />
                                    </button>
                                </div>
                                </div>
                            </div>
                            )}
                            </div>
                        </div>
                        ))}
                    </div>
                </div>
            ))}
          </div>
        )}
      </div>
    </div>
    );
  };

  const renderMap = () => (
    <div className="h-[600px] rounded-2xl overflow-hidden shadow-lg border border-slate-200 relative animate-fadeIn">
      <div id="map" ref={mapContainerRef} className="w-full h-full z-0 bg-slate-100"></div>
      
      {/* Map Overlay Card */}
      <div className="absolute top-4 right-4 z-[400] bg-white/90 backdrop-blur-sm p-4 rounded-xl shadow-lg max-w-xs border border-slate-100">
        <h4 className="font-bold text-slate-800 mb-2 flex items-center gap-2">
          <MapPin size={16} className="text-red-500" />
          {tripDetails.destination || "World Map"}
        </h4>
        <p className="text-xs text-slate-500 mb-3">
          Map centers on your destination.
        </p>
        <div className="text-xs font-mono bg-slate-100 p-2 rounded">
          Itinerary Points: {itinerary.length}
        </div>
      </div>
    </div>
  );

  const renderBudget = () => {
    const totals = getBudgetTotals();
    const totalBudget = parseCost(tripDetails.budget) || 1;
    const percentage = Math.min(100, (totals.totalSpent / totalBudget) * 100);

    return (
        <div className="animate-fadeIn">
            <SectionTitle 
                icon={Wallet} 
                title="Trip Budget" 
                subtitle={`Track expenses in ${tripDetails.homeCurrency}.`} 
            />

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                {/* Summary Card */}
                <Card className="p-6 md:col-span-3 bg-gradient-to-r from-slate-800 to-slate-900 text-white border-none shadow-lg">
                    <div className="flex flex-col md:flex-row justify-between items-end gap-6">
                        <div className="flex-1 w-full">
                            <h3 className="text-indigo-300 font-bold mb-1 text-sm uppercase tracking-wider">Total Spent (Actual)</h3>
                            <div className="text-4xl font-bold mb-4">{formatMoney(totals.totalSpent)}</div>
                            
                            <div className="space-y-2">
                                <div className="flex justify-between text-sm text-slate-300">
                                    <span>Progress</span>
                                    <span>{percentage.toFixed(1)}%</span>
                                </div>
                                <div className="w-full bg-slate-700/50 rounded-full h-3 overflow-hidden">
                                    <div 
                                        className={`h-full rounded-full transition-all duration-1000 ${totals.remaining < 0 ? 'bg-red-500' : 'bg-emerald-500'}`} 
                                        style={{ width: `${percentage}%` }}
                                    ></div>
                                </div>
                            </div>
                        </div>
                        <div className="flex flex-col gap-4 text-right min-w-[150px]">
                             <div>
                                <h4 className="text-indigo-300 text-xs uppercase font-bold mb-1">Remaining</h4>
                                <div className={`text-2xl font-bold ${totals.remaining < 0 ? 'text-red-400' : 'text-white'}`}>
                                    {formatMoney(totals.remaining)}
                                </div>
                             </div>
                             <div>
                                <h4 className="text-indigo-300 text-xs uppercase font-bold mb-1">Projected Total</h4>
                                <div className="text-xl font-bold text-slate-300">
                                    {formatMoney(totals.projectedTotal)}
                                </div>
                                <div className="text-[10px] text-slate-500">Includes unpaid planned items</div>
                             </div>
                        </div>
                    </div>
                </Card>

                {/* Add Expense Form */}
                <div className="md:col-span-1">
                    <Card className="p-5 h-full">
                        <h3 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <Plus size={18} className="text-indigo-600"/> Add Expense
                        </h3>
                        <form onSubmit={handleAddExpense} className="space-y-3">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Description</label>
                                <input name="title" required className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="e.g. Lunch" />
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Amount</label>
                                    <input type="number" step="0.01" name="amount" required className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm" placeholder="0.00" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Currency</label>
                                    <select name="currency" className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm">
                                        <option value={tripDetails.tripCurrency}>{tripDetails.tripCurrency}</option>
                                        <option value={tripDetails.homeCurrency}>{tripDetails.homeCurrency}</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Category</label>
                                <select name="category" className="w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm">
                                    {BUDGET_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>
                            <Button type="submit" className="w-full mt-2" icon={Plus}>Add Transaction</Button>
                        </form>
                    </Card>
                </div>

                {/* Transactions List */}
                <div className="md:col-span-2">
                    <Card className="h-full flex flex-col">
                        <div className="p-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                            <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                <PieChart size={18} /> Category Breakdown
                            </h3>
                        </div>
                        <div className="flex-1 overflow-y-auto max-h-[400px] p-4">
                            <div className="grid grid-cols-2 gap-4">
                                {Object.entries(totals.breakdown).map(([cat, amount]) => (
                                    <div key={cat} className="bg-slate-50 p-3 rounded-lg flex justify-between items-center">
                                        <span className="text-sm font-medium text-slate-700">{cat}</span>
                                        <span className="text-sm font-bold text-indigo-600">{formatMoney(amount)}</span>
                                    </div>
                                ))}
                            </div>
                            
                            <h3 className="font-bold text-slate-700 flex items-center gap-2 mt-6 mb-2">
                                <CreditCard size={18} /> Recent Expenses
                            </h3>
                            <div className="space-y-2">
                                    {[...expenses].reverse().slice(0, 5).map((expense) => (
                                        <div key={expense.id} className="flex items-center justify-between p-3 hover:bg-slate-50 rounded-lg group transition-colors border border-transparent hover:border-slate-100">
                                            <div className="flex items-center gap-3">
                                                <div className="p-2 bg-indigo-50 text-indigo-600 rounded-lg">
                                                    <DollarSign size={16} />
                                                </div>
                                                <div>
                                                    <div className="font-medium text-slate-800 text-sm">{expense.title}</div>
                                                    <div className="text-xs text-slate-500">{expense.category} • {new Date(expense.date).toLocaleDateString()}</div>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                <div className="text-right">
                                                    <div className="font-bold text-slate-700">{expense.currency} {expense.amount.toFixed(2)}</div>
                                                    {expense.currency !== tripDetails.homeCurrency && (
                                                        <div className="text-[10px] text-slate-400">
                                                            ~ {formatMoney(convertToHome(expense.amount, expense.currency))}
                                                        </div>
                                                    )}
                                                </div>
                                                <button 
                                                    onClick={() => setExpenses(expenses.filter(e => e.id !== expense.id))}
                                                    className="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"
                                                >
                                                    <Trash2 size={16} />
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                            </div>
                        </div>
                    </Card>
                </div>
            </div>
        </div>
    );
  };

  const renderSettingsModal = () => (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-2xl animate-fadeIn">
        <h3 className="text-xl font-bold mb-4">Settings</h3>
        <label className="block mb-2 text-sm font-medium text-slate-700">Gemini API Key</label>
        <input 
          type="password" 
          value={apiKey}
          onChange={(e) => setApiKey(e.target.value)}
          placeholder="Enter your API key..."
          className="w-full p-2 border rounded-lg mb-4 text-sm font-mono"
        />
        <p className="text-xs text-slate-500 mb-6">
          Your key is used locally for this session only. Leave empty to use Demo Mode with mock data.
        </p>
        <div className="flex justify-end gap-2">
          <Button variant="secondary" onClick={() => setShowSettings(false)}>Close</Button>
          <Button onClick={() => setShowSettings(false)}>Save</Button>
        </div>
      </div>
    </div>
  );

  // --- Layout ---

  return (
    <div className={`min-h-screen ${COLORS.bg} text-slate-800 font-sans selection:bg-indigo-100`}>
      {/* Header */}
      <header className="bg-white border-b border-slate-200 sticky top-0 z-30">
        <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
          <div className="flex items-center gap-2 text-indigo-600 cursor-pointer" onClick={() => setActiveTab('overview')}>
            <Plane size={24} className="transform -rotate-45" />
            <h1 className="text-xl font-extrabold tracking-tight text-slate-900">WanderPlan<span className="text-indigo-600">.</span></h1>
          </div>
          
          <nav className="hidden md:flex items-center gap-1 bg-slate-100 p-1 rounded-lg">
            {['overview', 'budget', 'checklists', 'itinerary', 'map'].map((tab) => (
              <button
                key={tab}
                onClick={() => setActiveTab(tab)}
                className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${
                  activeTab === tab 
                    ? 'bg-white text-indigo-600 shadow-sm' 
                    : 'text-slate-500 hover:text-indigo-600'
                }`}
              >
                {tab.charAt(0).toUpperCase() + tab.slice(1)}
              </button>
            ))}
          </nav>

          <button 
            onClick={() => setShowSettings(true)}
            className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-slate-50 rounded-full transition-colors"
          >
            <Settings size={20} />
          </button>
        </div>
        
        {/* Mobile Nav */}
        <div className="md:hidden border-t border-slate-100 flex justify-around p-2">
           {['overview', 'budget', 'checklists', 'itinerary', 'map'].map((tab) => (
              <button
                key={tab}
                onClick={() => setActiveTab(tab)}
                className={`p-2 rounded-lg ${activeTab === tab ? 'bg-indigo-50 text-indigo-600' : 'text-slate-400'}`}
              >
                {tab === 'overview' && <Home size={20} />}
                {tab === 'budget' && <Wallet size={20} />}
                {tab === 'checklists' && <CheckSquare size={20} />}
                {tab === 'itinerary' && <Calendar size={20} />}
                {tab === 'map' && <MapIcon size={20} />}
              </button>
            ))}
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-6xl mx-auto px-4 py-8">
        {activeTab === 'overview' && renderOverview()}
        {activeTab === 'budget' && renderBudget()}
        {activeTab === 'checklists' && renderChecklists()}
        {activeTab === 'itinerary' && renderItinerary()}
        {activeTab === 'map' && renderMap()}
      </main>

      {showSettings && renderSettingsModal()}
      
      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
          animation: fadeIn 0.4s ease-out forwards;
        }
      `}</style>
    </div>
  );
}